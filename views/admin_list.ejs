<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <h1>list page</h1>
    <script>
      document.addEventListener('DOMContentLoaded', async function () {
        const token = localStorage.getItem('token');

        if (!token) {
          console.error('âŒ ì €ì¥ëœ JWT í† í° ì—†ìŒ, ë¡œê·¸ì¸ í•„ìš”');
          alert('âŒ ë¡œê·¸ì¸ ì •ë³´ê°€ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.');
          window.location.href = '/login';
          return;
        }

        console.log('ğŸ”¹ ì €ì¥ëœ JWT í† í°:', token);

        try {
          const response = await fetch('/profile', {
            method: 'GET',
            headers: { Authorization: `Bearer ${token}` },
          });

          const userProfile = await response.json();
          console.log('âœ… ì‚¬ìš©ì í”„ë¡œí•„:', userProfile);

          if (!response.ok) {
            alert('âŒ ì¸ì¦ ì‹¤íŒ¨: ë‹¤ì‹œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.');
            localStorage.removeItem('token');
            window.location.href = '/login';
          }
        } catch (error) {
          console.error('âŒ í”„ë¡œí•„ ìš”ì²­ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
          localStorage.removeItem('token');
          window.location.href = '/login';
        }
      });
    </script>
  </body>
</html>
